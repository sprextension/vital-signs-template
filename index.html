<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vital Signs Formatter</title>
  <style>
    :root{
      --card-bg:#fff;
      --page-bg:#f4f6f8;
      --accent:#3498db;
      --accent-dark:#2980b9;
      --muted:#eef1f5;
      --text:#2c3e50;
    }

        body.dark {
      --card-bg: #1e1e1e;
      --page-bg: #121212;
      --accent: #3498db;
      --accent-dark: #2980b9;
      --muted: #2a2a2a;
      --text: #f4f4f4;
    }
    
      body.dark h2, 
      body.dark h3, 
      body.dark label {
        color: var(--text);
      }
      
      body.dark input, 
      body.dark select, 
      body.dark textarea {
        background: #2a2a2a;
        color: #f4f4f4;
        border: 1px solid #444;
    }
    
        body.dark pre {
          background: #2a2a2a;
          color: #f4f4f4;
        }
        
        body.dark .primary-button {
          background: var(--accent);
        }
        
        body.dark .copy-btn {
          background: #27ae60;
        }

    body{
      font-family: "Segoe UI", Roboto, Arial, sans-serif;
      background: var(--page-bg);
      margin:0;
      padding:20px;
      color:var(--text);
    }

    h2{ text-align:center; color:var(--text); margin-bottom:18px; }

    label{ font-weight:600; display:block; margin-top:10px; }

    /* form layout */
    .bed-container{
      background: var(--card-bg);
      padding:16px;
      border-radius:10px;
      box-shadow:0 2px 4px rgba(0,0,0,0.05);
      border:1px solid #ddd;
      margin-bottom:18px;
    }

    .bed-container h3{ margin:0 0 8px 0; color:#34495e; font-size:18px; }

    .checkbox-row{ display:flex; flex-wrap:wrap; gap:8px; margin:6px 0 12px 0; }

    /* default inputs full width, but some controls sized smaller via classes */
    input[type="text"], input[type="number"], select{
      width:100%;
      padding:10px;
      margin:6px 0 12px 0;
      border:1px solid #ccc;
      border-radius:6px;
      box-sizing:border-box;
      font-size:14px;
    }

    /* Clear Button */
    .template-row {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 12px;
    }
    
    .template-row select {
      flex: 1;
      padding: 8px;
    }

    .template-row button {
      padding: 8px 12px;
      font-size: 14px;
      border-radius: 6px;
      cursor: pointer;
    }

    /* Dark Mode */
    .top-right {
      position: absolute;
      top: 10px;
      right: 10px;
    }
    
    .top-right button {
      padding: 6px 12px;
      font-size: 14px;
      border-radius: 6px;
      cursor: pointer;
    }


    /* Template control sizing */
    .template-row{ display:flex; gap:8px; align-items:center; margin-top:6px; }
    .template-select{ width:160px; padding:6px; font-size:13px; }
    .small-btn{
      padding:6px 8px;
      font-size:13px;
      border-radius:6px;
      border:1px solid #ccc;
      background:#fff;
      cursor:pointer;
      min-width:40px;
    }
    .small-btn:active{ transform:translateY(1px); }

    /* primary action button */
    .primary-button{
      width:100%;
      padding:12px;
      font-size:16px;
      background:var(--accent);
      color:#fff;
      border:none;
      border-radius:6px;
      cursor:pointer;
      margin-top:10px;
    }
    .primary-button:hover{ background:var(--accent-dark); }

    /* Copy button near outputs */
    .copy-btn{
      padding:6px 8px;
      font-size:13px;
      border-radius:6px;
      border: none;
      background:#2ecc71;
      color:#fff;
      cursor:pointer;
      margin-bottom:8px;
    }

    pre{
      background:var(--muted);
      padding:12px;
      border-radius:8px;
      white-space:pre-wrap;
      overflow-x:auto;
      font-size:14px;
    }

    @media(min-width:600px){
      .bed-container, .primary-button, pre{ max-width:720px; margin:0 auto 18px auto; }
    }
  </style>
</head>
<body>

  <div class="top-right">
  <button onclick="toggleDarkMode()">ðŸŒ™ Dark Mode</button>
  <button id="sendBtn">Send to Bot</button>

</div>
  
  <h2>Vital Signs Formatter</h2>

  <label for="bedCount">How many beds are occupied?</label>
  <select id="bedCount" onchange="generateBedForms()">
    <option value="">Select...</option>
    <option value="1">1 bed</option><option value="2">2 beds</option><option value="3">3 beds</option>
    <option value="4">4 beds</option><option value="5">5 beds</option><option value="6">6 beds</option>
    <option value="7">7 beds</option><option value="8">8 beds</option><option value="9">9 beds</option>
    <option value="10">10 beds</option><option value="11">11 beds</option><option value="12">12 beds</option>
    <option value="13">13 beds</option><option value="14">14 beds</option>
  </select>

  <div id="bedsContainer"></div>

  <button onclick="generateAllMessages()">Generate All Messages</button>
  <button onclick="clearAllBeds()">Clear All Beds</button>
  

  <div id="output"></div>

  <script>
  // Helper to get the value of the selected checkbox in a class
  function getSelectedValue(className) {
    const checkboxes = document.getElementsByClassName(className);
    for (let cb of checkboxes) {
      if (cb.checked) return cb.value;
    }
    return "";
  }

  // Generate all messages grouped by category
  function generateAllMessages() {
    const bedCount = parseInt(document.getElementById("bedCount").value) || 0;
    let groups = { surgery: [], pedia: [], icu: [] };

    for (let i = 1; i <= bedCount; i++) {
      const patient = (document.getElementById(`patient${i}`) || {}).value || "";
      if (!patient) continue;

      const room = getSelectedValue(`room-checkbox${i}`);
      const bed = getSelectedValue(`bed-checkbox${i}`);
      const bp_sys = (document.getElementById(`bp_sys${i}`) || {}).value || "N/A";
      const bp_dia = (document.getElementById(`bp_dia${i}`) || {}).value || "N/A";
      const hr = (document.getElementById(`hr${i}`) || {}).value || "N/A";
      const temp = (document.getElementById(`temp${i}`) || {}).value || "N/A";
      const spo2 = (document.getElementById(`spo2${i}`) || {}).value || "N/A";
      const rbs = (document.getElementById(`rbs${i}`) || {}).value || "";
      const bm = (document.getElementById(`bm${i}`) || {}).value || "";
      const uo = (document.getElementById(`uo${i}`) || {}).value || "";

      const gcs_e = (document.getElementById(`gcs_e${i}`) || {}).value || "";
      const gcs_v = (document.getElementById(`gcs_v${i}`) || {}).value || "";
      const gcs_m = (document.getElementById(`gcs_m${i}`) || {}).value || "";
      const gcs_total = (document.getElementById(`gcs_total${i}`) || {}).value || "";

      const isMV = !!(document.getElementById(`mv${i}`) && document.getElementById(`mv${i}`).checked);
      const rrRaw = (document.getElementById(`rr${i}`) || {}).value || "N/A";
      const rr = isMV ? "MV" : rrRaw;

      let msg = `Room ${room || "?"} - Bed ${bed || "?"}\n`;
      msg += `Patient: ${patient}\n`;
      msg += `BP: ${bp_sys}/${bp_dia}\n`;
      msg += `HR: ${hr}\n`;
      msg += `RR: ${rr}\n`;
      msg += `Temp: ${temp}\n`;
      msg += `Oâ‚‚: ${spo2}\n`;
      if (gcs_total) msg += `GCS: E${gcs_e} V${gcs_v} M${gcs_m} = ${gcs_total}\n`;
      if (rbs) msg += `RBS: ${rbs}\n`;
      if (bm) msg += `BM: ${bm}\n`;
      if (uo) msg += `UO: ${uo}\n`;

      if (document.getElementById(`cat_surgery${i}`)?.checked) groups.surgery.push(msg);
      else if (document.getElementById(`cat_pedia${i}`)?.checked) groups.pedia.push(msg);
      else if (document.getElementById(`cat_icu${i}`)?.checked) groups.icu.push(msg);
    }

    let finalMsg = "";
    if (groups.surgery.length) finalMsg += "=== Surgery ===\n" + groups.surgery.join("\n") + "\n\n";
    if (groups.pedia.length) finalMsg += "=== Pedia ===\n" + groups.pedia.join("\n") + "\n\n";
    if (groups.icu.length) finalMsg += "=== ICU ===\n" + groups.icu.join("\n") + "\n\n";

    document.getElementById("output").innerText = finalMsg.trim();
    return finalMsg.trim();
  }

  // Send button listener
 document.getElementById("sendBtn").addEventListener("click", async function () {
    const bedCount = parseInt(document.getElementById("bedCount").value) || 0;
    if (!bedCount) { alert("Select number of beds first!"); return; }

    const message = generateAllMessages(); // this function uses bedCount internally now
    if (!message) { alert("No patient data to send!"); return; }

    try {
        const response = await fetch(
          "https://script.google.com/macros/s/AKfycbzis8FcAZbs20usOCx3BtV5dZMiZ20K5e7eONbBgSfYQ5HIdadcqpPiIVwSiW6lWfav/exec",
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message })
          }
        );
        const result = await response.json();
        if (response.ok) alert("Message sent successfully!");
        else alert("Error sending message: " + (result.error || JSON.stringify(result)));
    } catch (err) {
        alert("Network error: " + err.message);
    }
});

</script>
</body>
</html>







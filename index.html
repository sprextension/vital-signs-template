<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vital Signs Formatter</title>
  <style>
    :root{
      --card-bg:#fff;
      --page-bg:#f4f6f8;
      --accent:#3498db;
      --accent-dark:#2980b9;
      --muted:#eef1f5;
      --text:#2c3e50;
    }

        body.dark {
      --card-bg: #1e1e1e;
      --page-bg: #121212;
      --accent: #3498db;
      --accent-dark: #2980b9;
      --muted: #2a2a2a;
      --text: #f4f4f4;
    }
    
      body.dark h2, 
      body.dark h3, 
      body.dark label {
        color: var(--text);
      }
      
      body.dark input, 
      body.dark select, 
      body.dark textarea {
        background: #2a2a2a;
        color: #f4f4f4;
        border: 1px solid #444;
    }
    
        body.dark pre {
          background: #2a2a2a;
          color: #f4f4f4;
        }
        
        body.dark .primary-button {
          background: var(--accent);
        }
        
        body.dark .copy-btn {
          background: #27ae60;
        }

    body{
      font-family: "Segoe UI", Roboto, Arial, sans-serif;
      background: var(--page-bg);
      margin:0;
      padding:20px;
      color:var(--text);
    }

    h2{ text-align:center; color:var(--text); margin-bottom:18px; }

    label{ font-weight:600; display:block; margin-top:10px; }

    /* form layout */
    .bed-container{
      background: var(--card-bg);
      padding:16px;
      border-radius:10px;
      box-shadow:0 2px 4px rgba(0,0,0,0.05);
      border:1px solid #ddd;
      margin-bottom:18px;
    }

    .bed-container h3{ margin:0 0 8px 0; color:#34495e; font-size:18px; }

    .checkbox-row{ display:flex; flex-wrap:wrap; gap:8px; margin:6px 0 12px 0; }

    /* default inputs full width, but some controls sized smaller via classes */
    input[type="text"], input[type="number"], select{
      width:100%;
      padding:10px;
      margin:6px 0 12px 0;
      border:1px solid #ccc;
      border-radius:6px;
      box-sizing:border-box;
      font-size:14px;
    }

    /* Clear Button */
    .template-row {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 12px;
    }
    
    .template-row select {
      flex: 1;
      padding: 8px;
    }

    .template-row button {
      padding: 8px 12px;
      font-size: 14px;
      border-radius: 6px;
      cursor: pointer;
    }

    /* Dark Mode */
    .top-right {
      position: absolute;
      top: 10px;
      right: 10px;
    }
    
    .top-right button {
      padding: 6px 12px;
      font-size: 14px;
      border-radius: 6px;
      cursor: pointer;
    }


    /* Template control sizing */
    .template-row{ display:flex; gap:8px; align-items:center; margin-top:6px; }
    .template-select{ width:160px; padding:6px; font-size:13px; }
    .small-btn{
      padding:6px 8px;
      font-size:13px;
      border-radius:6px;
      border:1px solid #ccc;
      background:#fff;
      cursor:pointer;
      min-width:40px;
    }
    .small-btn:active{ transform:translateY(1px); }

    /* primary action button */
    .primary-button{
      width:100%;
      padding:12px;
      font-size:16px;
      background:var(--accent);
      color:#fff;
      border:none;
      border-radius:6px;
      cursor:pointer;
      margin-top:10px;
    }
    .primary-button:hover{ background:var(--accent-dark); }

    /* Copy button near outputs */
    .copy-btn{
      padding:6px 8px;
      font-size:13px;
      border-radius:6px;
      border: none;
      background:#2ecc71;
      color:#fff;
      cursor:pointer;
      margin-bottom:8px;
    }

    pre{
      background:var(--muted);
      padding:12px;
      border-radius:8px;
      white-space:pre-wrap;
      overflow-x:auto;
      font-size:14px;
    }

    @media(min-width:600px){
      .bed-container, .primary-button, pre{ max-width:720px; margin:0 auto 18px auto; }
    }
  </style>
</head>
<body>

  <div class="top-right">
  <button onclick="toggleDarkMode()">ðŸŒ™ Dark Mode</button>
  <button id="sendBtn">Send to Bot</button>

</div>
  
  <h2>Vital Signs Formatter</h2>

  <label for="bedCount">How many beds are occupied?</label>
  <select id="bedCount" onchange="generateBedForms()">
    <option value="">Select...</option>
    <option value="1">1 bed</option><option value="2">2 beds</option><option value="3">3 beds</option>
    <option value="4">4 beds</option><option value="5">5 beds</option><option value="6">6 beds</option>
    <option value="7">7 beds</option><option value="8">8 beds</option><option value="9">9 beds</option>
    <option value="10">10 beds</option><option value="11">11 beds</option><option value="12">12 beds</option>
    <option value="13">13 beds</option><option value="14">14 beds</option>
  </select>

  <div id="bedsContainer"></div>

  <button onclick="generateAllMessages()">Generate All Messages</button>
  <button onclick="clearAllBeds()">Clear All Beds</button>
  

  <div id="output"></div>

  <script>
/* ------------------------------
   Utility & UI helpers
   ------------------------------ */

function handleSingleCheck(event, className) {
  const checkboxes = document.getElementsByClassName(className);
  for (let box of checkboxes) {
    if (box !== event.target) box.checked = false;
  }
}

function toggleDarkMode() {
  document.body.classList.toggle("dark");
  localStorage.setItem("darkMode", document.body.classList.contains("dark"));
}

window.onload = function () {
  if (localStorage.getItem("darkMode") === "true") {
    document.body.classList.add("dark");
  }
};

function copyToClipboard(id) {
  const text = document.getElementById(id).innerText;
  navigator.clipboard.writeText(text).then(() => {
    alert('Copied to clipboard!');
  }).catch(err => {
    alert('Failed to copy: ' + err);
  });
}

function randomInRange(min, max, decimal = 0) {
  const val = Math.random() * (max - min) + min;
  return decimal > 0 ? parseFloat(val.toFixed(decimal)) : Math.round(val);
}

/* ------------------------------
   Bed form persistence
   ------------------------------ */

function saveBed(i) {
  try {
    const patient = document.getElementById(`patient${i}`)?.value || "";
    const sys = document.getElementById(`bp_sys${i}`)?.value || "";
    const dia = document.getElementById(`bp_dia${i}`)?.value || "";
    const hr = document.getElementById(`hr${i}`)?.value || "";
    const rr = document.getElementById(`rr${i}`)?.value || "";
    const mv = !!document.getElementById(`mv${i}`)?.checked;
    const temp = document.getElementById(`temp${i}`)?.value || "";
    const spo2 = document.getElementById(`spo2${i}`)?.value || "";
    const gcs_e = document.getElementById(`gcs_e${i}`)?.value || "";
    const gcs_v = document.getElementById(`gcs_v${i}`)?.value || "";
    const gcs_m = document.getElementById(`gcs_m${i}`)?.value || "";
    const gcs_total = document.getElementById(`gcs_total${i}`)?.value || "";
    const rbs = document.getElementById(`rbs${i}`)?.value || "";
    const bm = document.getElementById(`bm${i}`)?.value || "";
    const uo = document.getElementById(`uo${i}`)?.value || "";
    const template = document.getElementById(`template${i}`)?.value || "";

    let room = "";
    document.querySelectorAll(`.room-checkbox${i}`).forEach(b => { if (b.checked) room = b.value; });
    let bedNum = "";
    document.querySelectorAll(`.bed-checkbox${i}`).forEach(b => { if (b.checked) bedNum = b.value; });

    const categories = {
      surgery: !!document.getElementById(`cat_surgery${i}`)?.checked,
      pedia: !!document.getElementById(`cat_pedia${i}`)?.checked,
      icu: !!document.getElementById(`cat_icu${i}`)?.checked
    };

    const data = { patient, sys, dia, hr, rr, mv, temp, spo2, gcs_e, gcs_v, gcs_m, gcs_total, rbs, bm, uo, room, bedNum, categories, template };
    localStorage.setItem(`bed${i}`, JSON.stringify(data));
  } catch (err) {
    console.error("saveBed error", err);
  }
}

function clearBed(i) {
  const fields = ['bp_sys','bp_dia','hr','rr','temp','spo2','gcs_e','gcs_v','gcs_m','gcs_total','rbs','bm','uo'];
  fields.forEach(f => { const el = document.getElementById(`${f}${i}`); if(el){ el.value = ''; if(f==='rr') el.disabled = false;}});
  const mv = document.getElementById(`mv${i}`);
  if(mv){ mv.checked = false; const rrEl = document.getElementById(`rr${i}`); if(rrEl) rrEl.disabled = false;}
  saveBed(i);
}

/* ------------------------------
   Templates / randomizer
   ------------------------------ */

function applyTemplate(template, i) {
  if (!template) return;
  switch(template){
    case "normalAdult":
      document.getElementById(`bp_sys${i}`).value = randomInRange(110,130);
      document.getElementById(`bp_dia${i}`).value = randomInRange(70,85);
      document.getElementById(`hr${i}`).value = randomInRange(60,100);
      document.getElementById(`rr${i}`).value = randomInRange(12,20);
      document.getElementById(`temp${i}`).value = randomInRange(36.5,37.3,1);
      document.getElementById(`spo2${i}`).value = randomInRange(96,100);
      break;
    case "normalPedia":
      document.getElementById(`bp_sys${i}`).value = randomInRange(90,110);
      document.getElementById(`bp_dia${i}`).value = randomInRange(60,75);
      document.getElementById(`hr${i}`).value = randomInRange(80,120);
      document.getElementById(`rr${i}`).value = randomInRange(20,30);
      document.getElementById(`temp${i}`).value = randomInRange(36.5,37.5,1);
      document.getElementById(`spo2${i}`).value = randomInRange(97,100);
      break;
    case "lowBP":
      document.getElementById(`bp_sys${i}`).value = randomInRange(70,90);
      document.getElementById(`bp_dia${i}`).value = randomInRange(40,60);
      document.getElementById(`hr${i}`).value = randomInRange(110,140);
      document.getElementById(`rr${i}`).value = randomInRange(22,30);
      document.getElementById(`temp${i}`).value = randomInRange(36.0,37.0,1);
      document.getElementById(`spo2${i}`).value = randomInRange(85,92);
      break;
    case "highBP":
      document.getElementById(`bp_sys${i}`).value = randomInRange(150,170);
      document.getElementById(`bp_dia${i}`).value = randomInRange(95,110);
      document.getElementById(`hr${i}`).value = randomInRange(80,100);
      document.getElementById(`rr${i}`).value = randomInRange(16,22);
      document.getElementById(`temp${i}`).value = randomInRange(36.5,37.2,1);
      document.getElementById(`spo2${i}`).value = randomInRange(95,99);
      break;
  }
  saveBed(i);
}

function rerandomize(i){
  const template = document.getElementById(`template${i}`).value;
  if(!template){ alert('Please select a template first!'); return; }
  applyTemplate(template, i);
}

/* ------------------------------
   Build bed forms
   ------------------------------ */

function attachAutoSave(i){
  const textFields = ["patient","bp_sys","bp_dia","hr","rr","temp","spo2","gcs_e","gcs_v","gcs_m","gcs_total","rbs","bm","uo"];
  textFields.forEach(f=>{
    const el = document.getElementById(`${f}${i}`);
    if(el) el.addEventListener('input',()=>saveBed(i));
  });

  document.querySelectorAll(`.room-checkbox${i}`).forEach(cb=>cb.addEventListener('change', ev=>{handleSingleCheck(ev, `room-checkbox${i}`); saveBed(i);}));
  document.querySelectorAll(`.bed-checkbox${i}`).forEach(cb=>cb.addEventListener('change', ev=>{handleSingleCheck(ev, `bed-checkbox${i}`); saveBed(i);}));

  ["cat_surgery","cat_pedia","cat_icu"].forEach(base=>{
    const el = document.getElementById(`${base}${i}`);
    if(el) el.addEventListener('change',()=>saveBed(i));
  });

  const mv = document.getElementById(`mv${i}`);
  if(mv) mv.addEventListener('change',()=>{
    const rrEl = document.getElementById(`rr${i}`);
    if(mv.checked){ if(rrEl){ rrEl.value=""; rrEl.disabled=true; }}
    else { if(rrEl) rrEl.disabled=false;}
    saveBed(i);
  });

  const template = document.getElementById(`template${i}`);
  if(template) template.addEventListener('change', ()=>{ applyTemplate(template.value,i); });

  const rerand = document.getElementById(`rerand${i}`);
  if(rerand) rerand.addEventListener('click', ()=> rerandomize(i));

  const clearBtn = document.getElementById(`clear${i}`);
  if(clearBtn) clearBtn.addEventListener('click', ()=> clearBed(i));
}

/* ------------------------------
   Generate all messages
   ------------------------------ */

function generateAllMessages(){
  const bedCount = parseInt(document.getElementById("bedCount")?.value) || 0;
  if(!bedCount) return "";
  let result = "";
  for(let i=1;i<=bedCount;i++){
    const data = JSON.parse(localStorage.getItem(`bed${i}`) || "{}");
    if(!data.patient) continue;
    result += `Room ${data.room || "N/A"} - Bed ${data.bedNum || "N/A"}\nPatient: ${data.patient}\nBP: ${data.sys || "N/A"}/${data.dia || "N/A"}\nHR: ${data.hr || "N/A"}\nRR: ${data.mv ? "MV" : (data.rr || "N/A")}\nTemp: ${data.temp || "N/A"}\nOâ‚‚: ${data.spo2 || "N/A"}\n\n`;
  }
  return result;
}

/* ------------------------------
   DOMContentLoaded
   ------------------------------ */

document.addEventListener("DOMContentLoaded", ()=>{
  const bedCount = parseInt(document.getElementById("bedCount")?.value) || 0;
  for(let i=1;i<=bedCount;i++) attachAutoSave(i);

  // Copy button
  const copyBtn = document.getElementById("copyBtn");
  if(copyBtn) copyBtn.addEventListener("click", ()=>copyToClipboard("output"));

  // Send button
  const sendBtn = document.getElementById("sendBtn");
  if(sendBtn) sendBtn.addEventListener("click", async function(){
    const bedCount = parseInt(document.getElementById("bedCount")?.value) || 0;
    if(!bedCount){ alert("Select number of beds first!"); return; }
    const message = generateAllMessages();
    if(!message){ alert("No patient data to send!"); return; }

    try{
      const response = await fetch("https://script.google.com/macros/s/AKfycbyq-JFy-ULRCcO8Cqso3uGP9hVbgkCCsxoTTYONGq0vEH_rykjVyPk1Kkf7lmKJBZe_/exec",{
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ message })
      });
      const result = await response.json();
      if(response.ok) alert("Message sent successfully!");
      else alert("Error sending message: " + (result.error || JSON.stringify(result)));
    } catch(err){
      alert("Network error: " + err.message);
    }
  });

  // Dark mode toggle
  const darkBtn = document.getElementById("darkBtn");
  if(darkBtn) darkBtn.addEventListener('click', toggleDarkMode);
});
</script>
</body>
</html>







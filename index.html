<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Vital Signs Formatter</title>
<style>
:root{
  --card-bg:#fff;
  --page-bg:#f4f6f8;
  --accent:#3498db;
  --accent-dark:#2980b9;
  --muted:#eef1f5;
  --text:#2c3e50;
}
body.dark {
  --card-bg: #1e1e1e;
  --page-bg: #121212;
  --accent: #3498db;
  --accent-dark: #2980b9;
  --muted: #2a2a2a;
  --text: #f4f4f4;
}
body.dark input, body.dark select, body.dark textarea { background:#2a2a2a; color:#f4f4f4; border:1px solid #444; }
body.dark pre { background:#2a2a2a; color:#f4f4f4; }
body.dark .primary-button { background: var(--accent); }

body{ font-family:"Segoe UI", Roboto, Arial, sans-serif; background:var(--page-bg); margin:0; padding:20px; color:var(--text); }
h2{text-align:center; margin-bottom:18px;}
label{ font-weight:600; display:block; margin-top:10px; }
.bed-container{ background: var(--card-bg); padding:16px; border-radius:10px; box-shadow:0 2px 4px rgba(0,0,0,0.05); border:1px solid #ddd; margin-bottom:18px;}
input[type="text"], input[type="number"], select{ width:100%; padding:10px; margin:6px 0 12px 0; border:1px solid #ccc; border-radius:6px; box-sizing:border-box; font-size:14px;}
.template-row { display:flex; gap:6px; align-items:center; margin-top:6px; flex-wrap:wrap; }
.template-select{ width:160px; padding:6px; font-size:13px; }
.small-btn{ padding:6px 8px; font-size:13px; border-radius:6px; border:1px solid #ccc; background:#fff; cursor:pointer; min-width:40px; }
.small-btn:active{ transform:translateY(1px); }
.primary-button{ width:100%; padding:12px; font-size:16px; background:var(--accent); color:#fff; border:none; border-radius:6px; cursor:pointer; margin-top:10px; }
.primary-button:hover{ background:var(--accent-dark); }
.copy-btn{ padding:6px 8px; font-size:13px; border-radius:6px; border: none; background:#2ecc71; color:#fff; cursor:pointer; margin-bottom:8px; }
pre{ background:var(--muted); padding:12px; border-radius:8px; white-space:pre-wrap; overflow-x:auto; font-size:14px; }
@media(min-width:600px){ .bed-container, .primary-button, pre{ max-width:720px; margin:0 auto 18px auto; } }
.top-right { position:absolute; top:10px; right:10px; display:flex; gap:6px; }
.top-right button { padding:6px 12px; font-size:14px; border-radius:6px; cursor:pointer; }
</style>
</head>
<body>

<div class="top-right">
  <button onclick="toggleDarkMode()">ðŸŒ™ Dark Mode</button>
  <button id="sendBtn">Send to Bot</button>
</div>

<h2>Vital Signs Formatter</h2>

<label for="bedCount">How many beds are occupied?</label>
  <select id="bedCount" onchange="generateBedForms()">
  <option value="">Select...</option>
  <option value="1">1 bed</option>
  <option value="2">2 beds</option>
  <option value="3">3 beds</option>
  <option value="4">4 beds</option>
  <option value="5">5 beds</option>
  <option value="6">6 beds</option>
  <option value="7">7 beds</option>
  <option value="8">8 beds</option>
  <option value="9">9 beds</option>
  <option value="10">10 beds</option>
  <option value="11">11 beds</option>
  <option value="12">12 beds</option>
  <option value="13">13 beds</option>
  <option value="14">14 beds</option>
</select>

<div id="bedsContainer"></div>

<button class="primary-button" onclick="generateAllMessages()">Generate All Messages</button>
<button class="primary-button" onclick="clearAllBeds()">Clear All Beds</button>

<pre id="output"></pre>

<script>
function toggleDarkMode() {
  document.body.classList.toggle("dark");
  localStorage.setItem("darkMode", document.body.classList.contains("dark"));
}
if(localStorage.getItem("darkMode")==="true") document.body.classList.add("dark");

function randomInRange(min,max,d=0){ const v=Math.random()*(max-min)+min; return d>0?parseFloat(v.toFixed(d)):Math.round(v); }

function saveBedData(i){
  const data={
    patient: document.getElementById(`patient${i}`)?.value||"",
    bp_sys: document.getElementById(`bp_sys${i}`)?.value||"",
    bp_dia: document.getElementById(`bp_dia${i}`)?.value||"",
    hr: document.getElementById(`hr${i}`)?.value||"",
    rr: document.getElementById(`rr${i}`)?.value||"",
    mv: document.getElementById(`mv${i}`)?.checked||false,
    temp: document.getElementById(`temp${i}`)?.value||"",
    spo2: document.getElementById(`spo2${i}`)?.value||"",
    template: document.getElementById(`template${i}`)?.value||""
  };
  localStorage.setItem(`bed${i}`, JSON.stringify(data));
}

function loadBedData(i){
  const saved=localStorage.getItem(`bed${i}`);
  if(!saved) return;
  const data=JSON.parse(saved);
  document.getElementById(`patient${i}`).value=data.patient;
  document.getElementById(`bp_sys${i}`).value=data.bp_sys;
  document.getElementById(`bp_dia${i}`).value=data.bp_dia;
  document.getElementById(`hr${i}`).value=data.hr;
  document.getElementById(`rr${i}`).value=data.rr;
  document.getElementById(`mv${i}`).checked=data.mv;
  document.getElementById(`temp${i}`).value=data.temp;
  document.getElementById(`spo2${i}`).value=data.spo2;
  document.getElementById(`template${i}`).value=data.template;
}

function changeBedCount(){
  const count=document.getElementById('bedCount').value;
  localStorage.setItem("bedCount",count);
  generateBedForms();
}

function applyTemplate(template,i){
  if(!template) return;
  switch(template){
    case "normalAdult": 
      document.getElementById(`bp_sys${i}`).value=randomInRange(110,130);
      document.getElementById(`bp_dia${i}`).value=randomInRange(70,85);
      document.getElementById(`hr${i}`).value=randomInRange(60,100);
      document.getElementById(`rr${i}`).value=randomInRange(12,20);
      document.getElementById(`temp${i}`).value=randomInRange(36.5,37.3,1);
      document.getElementById(`spo2${i}`).value=randomInRange(96,100);
      break;
    case "normalPedia":
      document.getElementById(`bp_sys${i}`).value=randomInRange(90,110);
      document.getElementById(`bp_dia${i}`).value=randomInRange(60,75);
      document.getElementById(`hr${i}`).value=randomInRange(80,120);
      document.getElementById(`rr${i}`).value=randomInRange(20,30);
      document.getElementById(`temp${i}`).value=randomInRange(36.5,37.5,1);
      document.getElementById(`spo2${i}`).value=randomInRange(97,100);
      break;
    case "lowBP":
      document.getElementById(`bp_sys${i}`).value=randomInRange(70,90);
      document.getElementById(`bp_dia${i}`).value=randomInRange(40,60);
      document.getElementById(`hr${i}`).value=randomInRange(110,140);
      document.getElementById(`rr${i}`).value=randomInRange(22,30);
      document.getElementById(`temp${i}`).value=randomInRange(36.0,37.0,1);
      document.getElementById(`spo2${i}`).value=randomInRange(85,92);
      break;
    case "highBP":
      document.getElementById(`bp_sys${i}`).value=randomInRange(150,170);
      document.getElementById(`bp_dia${i}`).value=randomInRange(95,110);
      document.getElementById(`hr${i}`).value=randomInRange(80,100);
      document.getElementById(`rr${i}`).value=randomInRange(16,22);
      document.getElementById(`temp${i}`).value=randomInRange(36.5,37.2,1);
      document.getElementById(`spo2${i}`).value=randomInRange(95,99);
      break;
  }
  saveBedData(i);
}

function rerollBed(i){
  const templateSelect=document.getElementById(`template${i}`);
  applyTemplate(templateSelect.value,i);
}

function generateBedForms() {
  const container=document.getElementById('bedsContainer');
  container.innerHTML="";
  const count=parseInt(localStorage.getItem("bedCount"))||0;
  document.getElementById("bedCount").value=count;

  for(let i=1;i<=count;i++){
    const div=document.createElement('div'); div.className='bed-container';
    div.innerHTML=`
      <h3>Room & Bed ${i}</h3>
      <label>Patient Name:</label>
      <input type="text" id="patient${i}" placeholder="Patient Name">
      <label>BP (mmHg):</label>
      <div style="display:flex; gap:6px;">
        <input type="number" id="bp_sys${i}" placeholder="Sys" style="flex:1;">
        <span>/</span>
        <input type="number" id="bp_dia${i}" placeholder="Dia" style="flex:1;">
      </div>
      <label>HR (bpm):</label><input type="number" id="hr${i}">
      <label>RR (/min):</label><input type="number" id="rr${i}"> <label><input type="checkbox" id="mv${i}"> MV</label>
      <label>Temp (Â°C):</label><input type="number" step="0.1" id="temp${i}">
      <label>Oâ‚‚ Saturation (%):</label><input type="number" id="spo2${i}">
      <div class="template-row">
        <select id="template${i}" class="template-select">
          <option value="">Choose Template</option>
          <option value="normalAdult">Normal Adult</option>
          <option value="normalPedia">Normal Pedia</option>
          <option value="lowBP">Low BP</option>
          <option value="highBP">High BP</option>
        </select>
        <button class="small-btn" onclick="rerollBed(${i})">Reroll</button>
      </div>
    `;
    container.appendChild(div);

    loadBedData(i);

    ['patient','bp_sys','bp_dia','hr','rr','mv','temp','spo2','template'].forEach(field=>{
      const el=document.getElementById(`${field}${i}`);
      el?.addEventListener('input',()=>saveBedData(i));
      if(el?.type==='checkbox') el.addEventListener('change',()=>saveBedData(i));
    });
  }
}

function clearAllBeds(){ 
  const count=parseInt(localStorage.getItem("bedCount"))||0; 
  for(let i=1;i<=count;i++) localStorage.removeItem(`bed${i}`); 
  localStorage.removeItem("bedCount");
  document.getElementById("bedCount").value="";
  generateBedForms(); 
  document.getElementById("output").innerHTML=""; 
}

function generateAllMessages() {
  const count=parseInt(localStorage.getItem("bedCount"))||0;
  let finalMsg="";
  for(let i=1;i<=count;i++){
    const patient=document.getElementById(`patient${i}`)?.value||"";
    if(!patient) continue;
    const bp_sys=document.getElementById(`bp_sys${i}`)?.value||"N/A";
    const bp_dia=document.getElementById(`bp_dia${i}`)?.value||"";
    const hr=document.getElementById(`hr${i}`)?.value||"N/A";
    const rr=document.getElementById(`mv${i}`)?.checked?"MV":document.getElementById(`rr${i}`)?.value||"N/A";
    const temp=document.getElementById(`temp${i}`)?.value||"N/A";
    const spo2=document.getElementById(`spo2${i}`)?.value||"N/A";
    finalMsg+=`Room ${i} - Bed ${i}\nPatient: ${patient}\nBP: ${bp_sys}/${bp_dia}\nHR: ${hr}\nRR: ${rr}\nTemp: ${temp}\nOâ‚‚: ${spo2}\n\n`;
  }
  document.getElementById("output").innerText=finalMsg.trim();
  return finalMsg.trim();
}

// Send via Google Apps Script
document.getElementById("sendBtn").addEventListener("click", async ()=>{
  const message=generateAllMessages();
  try{
    const res=await fetch("https://script.google.com/macros/s/YOUR_DEPLOY_ID/exec",{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({ message })
    });
    const data=await res.json();
    if(data.success) alert("Message sent successfully!");
    else alert("Error sending message: "+data.error);
  } catch(err){ alert("Network error: "+err.message); }
});

// Load initial state
window.onload=generateBedForms;
</script>
</body>
</html>

